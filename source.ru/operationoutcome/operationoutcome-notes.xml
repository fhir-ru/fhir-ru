<div xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/1999/xhtml ../../schema/fhir-xhtml.xsd" xmlns="http://www.w3.org/1999/xhtml">


<!--
Grahame's OAuth extensions:
<extension url="http://www.healthintersections.com.au/fhir/extensions#oauth-reference">
  <extension url="http://www.healthintersections.com.au/fhir/extensions#oauth-name">
    <valueUri value="Google+"/>
  </extension>
  <extension url="http://www.healthintersections.com.au/fhir/extensions#oauth-img-src">
    <valueUri value="https://developers.google.com/accounts/images/sign-in-with-google.png"/>
  </extension>
  <extension url="http://www.healthintersections.com.au/fhir/extensions#oauth-link">
    <valueUri value="https://accounts.google.com/o/oauth2/auth?client_id=..."/>
  </extension>
</extension>
-->
<a name="oo"> </a>

<h2>Применение ресурсов Operation Outcome<!-- Using Operation Outcome Resources --></h2>
<p>
В RESTful-интерфейсе ресурсы operation outcome имеют значение, только когда уровень вычислимой детализации требуется выше, чем предоставляемый HTTP-кодами ответов. Такая детализация может включать:
<!-- On the RESTful interface, operation outcome resources are only relevant when a level of computable detail is required that is more granular than that provided by the HTTP response codes.
This granularity could include: -->
</p>
<ul>
<li>больше информации о местоположении проблемы<!-- more detail about the location of an issue --></li>
<li>возможность идентифицировать несколько различных проблем<!-- the ability to identify multiple distinct issues --></li>
<li>предоставление более тонких кодов ошибок, связанных с известными бизнес-состояниями сбоев <!-- provision of finer error codes that connect to known business failure states --></li>
</ul>

<p>
Возвращаемые ресурсы Operation outcomes ДОЛЖНЫ соответствовать HTTP-кодам ответов. Например, если HTTP-код указывает на сбой (300+), по меньшей мере одна из проблем должна иметь степень тяжести "ошибка" с указанием причины этого сбоя.
<!-- Operation outcomes returned SHOULD be in alignment with the HTTP response code.  For example, if the HTTP code indicates a failure (300+), at least
one of the issues should have a severity of "error", indicating the reason for the failure. -->
</p>

<a name="loc"> </a>
<h2>Применение элемента Location<!-- Using the Location Element --></h2>
<p>
Для каждой проблемы в результатах выполнения операций должно сообщаться место. Системы, генерирующие результаты операций, должны указывать места ошибок. Правильно указанное место позволит системам-клиентам:
<!-- Each issue in an operation outcome may have a location reported. 
Systems that create operation outcomes SHOULD populate the 
location of an error. A correctly propulated location can 
allow client systems to: -->
</p>
<ul>
 <li>связывать возвращённые ошибки с подходящим виджетом пользовательского интерфейса</li>
 <li>направлять ошибки в соответствующий журнал аудита приложения или системы</li>
 <li>разрабатывать более интеллектуальные тестирующие приложения</li>
<!--  <li>Connect return errors with the appropriate UI widget</li>
 <li>Route errors to the corect application or system log</li>
 <li>Develop more intelligent testing applications</li> -->
</ul>

<p>
Чтобы поддержать эти виды использования, приложениям требуется должным образом использовать элемент location. Приложения могут использовать элемент location, чтобы ссылаться на место внутри ресурса или некоторое место в HTTP-запросе (когда это целесообразно).
<!-- In order to support these kinds of usages, this applications
need to use the location element consistently. Applications
can use the location element to refer to a location inside
a resource, or some location in the HTTP request (when appropriate).  -->
</p>
<h3>Сообщение об ошибках в ресурсах<!-- Reporting Errors in Resources --></h3>
<p>
Хотя ресурсы могут быть представлены в XML, JSON или других форматах, места ошибок всегда сообщаются с помощью упрощённой системы обозначений XPath:
<!-- While resources may be represented in XML, JSON, or other forms, 
error locations are always reported using a simplified XPath 
notation: -->
</p>
<pre>
 &lt;location value=&quot;/f:Patient/f:identifier&quot;/&gt;
</pre>
<p>
XPath-выражение должно использовать <a href="elementdefinition-definitions.html#ElementDefinition.constraint.xpath">стандартные XPath-префиксы FHIR f: и h:</a> для пространств имён FHIR и XHTML соответственно.
<!-- The XPath must use the <a href="elementdefinition-definitions.html#ElementDefinition.constraint.xpath">FHIR standard XPath prefixes f: and h:</a>
for the FHIR and XHTML namespaces respectively. -->
</p>
<p>
XPath здесь можно использовать для автоматического поиска соответствующего XML-элемента в ресурсе, если этот ресурс представлен в формате XML. Поскольку ресурсы часто представлены в формате JSON, и так как приложения часто обрабатывают XPath-выражения напрямую (например для определения соответствующего виджета), XPath-выражение должно быть простым. В частности, XPath должен содержать только имена элементов и индикаторы повтора. Поэтому это правильное выражение:
<!-- The XPath here can be used to automatically find 
the relevant XML element in a resource if the resource 
is represented in XML. Because resources are often represented
in JSON, and because applications will often process the XPath
directly (e.g. to determine the relevant widget), the XPath
statement must be simple. Specifically, the XPath
SHALL only contain element names and repetition indicators.
So this is legal: -->
</p>
<pre>
 &lt;location value=&quot;/f:Patient/f:identifier[2]/f:label&quot;/&gt;
</pre>
<p>
а это - нет:
<!-- but this is not: -->
</p>
<pre>
 &lt;location value=&quot;/f:Patient/f:identifier[f:system/@value='http://example.com/mrn']/f:label&quot;/&gt;
</pre>
<p>
Поскольку Xpath должен быть простым, его можно преобразовать в <a href="https://tools.ietf.org/html/rfc6901">JsonPointer</a>, отбросив префиксы пространств имён и откорректировав смещения массивов. XPaths-выражения выше могут иметь следующие эквивалентные JsonPointer-представления:
<!-- Because the Xpath is required to be simple, it can be converted
to <a href="https://tools.ietf.org/html/rfc6901">JsonPointer</a>
by dropping the namespace prefixes, and correcting for array offsets. The XPaths above have these 
equivalent JsonPointer representations: -->
</p>
<pre>
 Patient/identifier
 Patient/identifier/2/label
</pre>
<p>
Обратите внимание, что для исправления сдвигов массивов требуется знание, какие элементы считаются массивами в JSON. Также можно преобразовать XPath-выражения в JsonPath, хотя единого стандарта для JsonPath нету.
<!-- Note that correcting for array offsets may require knowledge of 
which elements are Arrays in JSON. It is also possible to 
convert the XPath statements to JsonPath, though there is no
single standard for JsonPath. -->
</p>
<h3>Сообщение об ошибках в HTTP-заголовках<!-- Reporting Errors in the HTTP Headers --></h3>
<p>
Серверам может также потребоваться сообщить об ошибках в HTTP-заголовках - особенно параметры запроса при выполнении поиска. Ошибки сообщаются с помощью чувствительного к регистру заголовка location, содержащего две части: фиксированную "http" и заголовок или имя параметра запроса, разделённое символом".". Вот несколько примеров: 
<!-- Servers may also need to report errors in the HTTP headers - especially 
query parameters when processing searches. Errors are reported using 
a case sensitive location that has two parts, a fixed "http" and 
the header or query parameter name separated by a ".". Some
examples: -->
</p>
<table class="grid">
 <tr>
   <td><b>Место</b></td>
   <td><b>Описание</b></td>
 </tr>
 <tr>
   <td>http.name:exact</td>
   <td>Ссылка на поисковый параметр "name" с модификатором ":exact"</td>
 </tr>
 <tr>
   <td>http.Authorization</td>
   <td>Ссылка на заголовок Authorization - возможно для индикации, что он отсутствует, и требуется некоторая форма аутентификации.</td>
 </tr>
<!--  <tr>
   <td><b>Location</b></td>
   <td><b>Description</b></td>
 </tr>
 <tr>
   <td>http.name:exact</td>
   <td>A reference to the search parameter "name" with the modifier ":exact"</td>
 </tr>
 <tr>
   <td>http.Authorization</td>
   <td>A reference to the Authorization header - perhaps to indicate that it is missing, and some form of authentication is required.</td>
 </tr> -->
</table>

</div>
